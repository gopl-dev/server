// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.960
package page

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import . "github.com/gopl-dev/server/frontend/component"

func CreateBookForm() templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<script>\r\n    function createBookForm() {\r\n        return {\r\n            form: {\r\n                title: '',\r\n                description: '',\r\n                author_name: '',\r\n                author_link: '',\r\n                homepage: '',\r\n                release_date: '',\r\n                cover_file_id: '',\r\n                visibility: 'public',\r\n            },\r\n\r\n            // Cover upload UI state\r\n            coverUpload: {\r\n                uploading: false,\r\n                error: '',\r\n                fileName: '',\r\n            },\r\n\r\n            success: false,\r\n            error: '',\r\n            errors: {\r\n                title: '',\r\n                description: '',\r\n                author_name: '',\r\n                author_link: '',\r\n                homepage: '',\r\n                release_date: '',\r\n                cover_file_id: '',\r\n                visibility: '',\r\n            },\r\n\r\n            get coverPreviewURL() {\r\n                if (!this.form.cover_file_id) return ''\r\n                return `/files/${this.form.cover_file_id}/?preview`\r\n            },\r\n\r\n            async uploadCover(e) {\r\n                this.coverUpload.error = ''\r\n                const file = e?.target?.files?.[0]\r\n                if (!file) return\r\n\r\n                this.coverUpload.uploading = true\r\n                this.coverUpload.fileName = file.name\r\n\r\n                try {\r\n                    const fd = new FormData()\r\n                    fd.append('file', file)\r\n                    fd.append('purpose', 'book-cover')\r\n\r\n                    const resp = await fetch('/api/files/', {\r\n                        method: 'POST',\r\n                        body: fd,\r\n                    })\r\n\r\n                    const data = await resp.json()\r\n\r\n                    if (resp.status !== 201) {\r\n                        this.form.cover_file_id = ''\r\n                        this.coverUpload.error = data?.error || 'Cover upload failed'\r\n                        return\r\n                    }\r\n\r\n                    // expects { id: \"...\" }\r\n                    this.form.cover_file_id = data.id\r\n                } catch (err) {\r\n                    this.form.cover_file_id = ''\r\n                    this.coverUpload.error = 'Cover upload failed'\r\n                } finally {\r\n                    this.coverUpload.uploading = false\r\n                }\r\n            },\r\n\r\n            async removeCover() {\r\n                this.coverUpload.error = ''\r\n\r\n                const id = this.form.cover_file_id\r\n                if (!id) return\r\n\r\n                try {\r\n                    const resp = await fetch('/api/files/'+id+'/', {\r\n                        method: 'DELETE',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                    })\r\n\r\n                    if (resp.status !== 200 && resp.status !== 204) {\r\n                        let msg = 'Remove failed'\r\n                        try {\r\n                            const data = await resp.json()\r\n                            if (data?.error) msg = data.error\r\n                        } catch (_) {}\r\n                        this.coverUpload.error = msg\r\n                        return\r\n                    }\r\n\r\n                    this.form.cover_file_id = ''\r\n                    this.coverUpload.fileName = ''\r\n                } catch (err) {\r\n                    this.coverUpload.error = 'Remove failed'\r\n                }\r\n            },\r\n\r\n            submitForm() {\r\n                this.error = ''\r\n                this.errors = {\r\n                    title: '',\r\n                    description: '',\r\n                    author_name: '',\r\n                    author_link: '',\r\n                    homepage: '',\r\n                    release_date: '',\r\n                    cover_file_id: '',\r\n                    visibility: '',\r\n                }\r\n\r\n                fetch('/api/books/', {\r\n                    method: 'POST',\r\n                    headers: {'Content-Type': 'application/json'},\r\n                    body: JSON.stringify(this.form)\r\n                })\r\n                    .then(resp => {\r\n                        if (resp.status === 201) {\r\n                            this.success = true;\r\n                        }\r\n\r\n                        return resp.json();\r\n                    })\r\n                    .then(resp => {\r\n                        if (this.success) return;\r\n\r\n                        if (resp.status !== 200 && \"error\" in resp) {\r\n                            this.error = resp.error\r\n                        }\r\n                        if (resp.status !== 200 && resp.input_errors !== null) {\r\n                            let ie = resp.input_errors\r\n                            if (\"title\" in ie) {\r\n                                this.errors.title = ie.title\r\n                            }\r\n                            if (\"description\" in ie) {\r\n                                this.errors.description = ie.description\r\n                            }\r\n                            if (\"author_name\" in ie) {\r\n                                this.errors.author_name = ie.author_name\r\n                            }\r\n                            if (\"author_link\" in ie) {\r\n                                this.errors.author_link = ie.author_link\r\n                            }\r\n                            if (\"homepage\" in ie) {\r\n                                this.errors.homepage = ie.homepage\r\n                            }\r\n                            if (\"release_date\" in ie) {\r\n                                this.errors.release_date = ie.release_date\r\n                            }\r\n                            if (\"cover_file_id\" in ie) {\r\n                                this.errors.cover_file_id = ie.cover_file_id\r\n                            }\r\n                            if (\"visibility\" in ie) {\r\n                                this.errors.visibility = ie.visibility\r\n                            }\r\n                        }\r\n                    })\r\n                    .catch(response => {\r\n                    })\r\n            }\r\n        }\r\n    }\r\n</script><div class=\"flex flex-row justify-center\"><div class=\"w-full lg:w-1/2\"><h1 class=\"text-3xl pb-4\">Add Book</h1><div class=\"bg-base-100 w-full shadow-2xl\"><div class=\"card-body\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "<p class=\"text-red-500\" x-text=\"error\" x-show=\"error !== ''\"></p><div role=\"alert\" class=\"alert alert-success\" x-show=\"success\"><svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6 shrink-0 stroke-current\" fill=\"none\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg> <span>Book created successfully!<!-- TODO: add links: view book | add another one | my books | all books --></span></div><div x-show=\"!success\"><fieldset class=\"fieldset\"><!-- Cover upload --><div class=\"p-2\"><label class=\"label\"><span class=\"label-text\">Cover file</span></label> <input type=\"file\" accept=\"image/*\" class=\"file-input file-input-bordered w-full\" @change=\"uploadCover($event)\" :disabled=\"coverUpload.uploading\"><div class=\"text-sm opacity-70 mt-1\" x-show=\"coverUpload.fileName !== ''\">Selected: <span x-text=\"coverUpload.fileName\"></span></div><div class=\"text-sm mt-1\" x-show=\"coverUpload.uploading\">Uploading...</div><p class=\"text-red-500 mt-1\" x-show=\"coverUpload.error !== ''\" x-text=\"coverUpload.error\"></p><!-- Preview (GET /files/{id}/) --><div class=\"mt-3\" x-show=\"form.cover_file_id !== ''\"><div class=\"text-sm opacity-70 mb-2\">Uploaded. cover_file_id: <span x-text=\"form.cover_file_id\"></span></div><img class=\"rounded-lg max-h-64\" :src=\"coverPreviewURL\" alt=\"Cover preview\"><div class=\"mt-2\"><button type=\"button\" class=\"btn btn-outline btn-sm\" @click=\"removeCover()\" :disabled=\"coverUpload.uploading\">Remove</button></div></div><input type=\"hidden\" name=\"cover_file_id\" :value=\"form.cover_file_id\"></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = Input(InputParams{
				ID:         "title",
				Label:      "Title",
				Model:      "form.title",
				ErrorModel: "errors.title",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = Textarea(InputParams{
				ID:         "description",
				Label:      "Description",
				Model:      "form.description",
				ErrorModel: "errors.description",
				Type:       "textarea",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = Input(InputParams{
				ID:         "author_name",
				Label:      "Author Name",
				Model:      "form.author_name",
				ErrorModel: "errors.author_name",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = Input(InputParams{
				ID:         "author_link",
				Label:      "Author Link",
				Model:      "form.author_link",
				ErrorModel: "errors.author_link",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = Input(InputParams{
				ID:          "homepage",
				Label:       "Homepage",
				Model:       "form.homepage",
				ErrorModel:  "errors.homepage",
				Description: "Where to find more information about this book",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = Input(InputParams{
				ID:         "release_date",
				Label:      "Release Date",
				Model:      "form.release_date",
				ErrorModel: "errors.release_date",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = Radio(RadioParams{
				Label:      "Visibility",
				Model:      "form.visibility",
				ErrorModel: "errors.visibility",
				Items: []RadioItem{
					{Label: "Public", Value: "public", Description: "Visible to everyone and indexed"},
					{Label: "Private", Value: "private", Description: "Visible only to you"},
					{Label: "Unlisted", Value: "unlisted", Description: "Accessible only via direct link"},
				},
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "<div class=\"p-2\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = SubmitButton("Add book").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, "</div></fieldset></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = Form("createBookForm").Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 5, "</div></div></div></div>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
