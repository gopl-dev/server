// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.960
package page

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

func FilterBooksPage() templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<script>\r\n    function booksPage() {\r\n        return {\r\n            books: [],\r\n            loading: false,\r\n            error: '',\r\n            page: 1,\r\n            perPage: 10,\r\n            total: 0,\r\n            loadedOnce: false,\r\n\r\n            coverURL(fileID) {\r\n                return '/files/' + fileID + '/?preview'\r\n            },\r\n\r\n            get totalPages() {\r\n                return Math.max(1, Math.ceil(this.total / this.perPage))\r\n            },\r\n\r\n            readFromURL() {\r\n                const url = new URL(window.location.href)\r\n                const p = parseInt(url.searchParams.get('page') || '', 10)\r\n                if (Number.isFinite(p) && p > 0) this.page = p\r\n            },\r\n\r\n            writeToURL() {\r\n                const url = new URL(window.location.href)\r\n                if (this.page === 1) {\r\n                    url.searchParams.delete('page')\r\n                } else {\r\n                    url.searchParams.set('page', String(this.page))\r\n                }\r\n                window.history.replaceState({}, '', url.toString())\r\n            },\r\n\r\n            onPopState() {\r\n                this.readFromURL()\r\n                this.load(this.page, { syncURL: false, scrollTop: true })\r\n            },\r\n\r\n            init() {\r\n                this.readFromURL()\r\n                window.addEventListener('popstate', () => this.onPopState())\r\n                this.load(this.page, { syncURL: false, scrollTop: false })\r\n            },\r\n\r\n            scrollToTop() {\r\n                if (window.scrollY > 80) {\r\n                    window.scrollTo({ top: 0, behavior: 'smooth' })\r\n                }\r\n            },\r\n\r\n            get pageButtons() {\r\n                const max = this.totalPages\r\n                const cur = this.page\r\n\r\n                const start = Math.max(2, cur - 3)\r\n                const end = Math.min(max - 1, cur + 3)\r\n\r\n                const btns = []\r\n                for (let p = start; p <= end; p++) btns.push(p)\r\n                return btns\r\n            },\r\n\r\n            get showLeftDots() {\r\n                return this.pageButtons.length > 0 && this.pageButtons[0] > 2\r\n            },\r\n\r\n            get showRightDots() {\r\n                const btns = this.pageButtons\r\n                return btns.length > 0 && btns[btns.length - 1] < this.totalPages - 1\r\n            },\r\n\r\n            gotoPage(p) {\r\n                if (p < 1) p = 1\r\n                if (p > this.totalPages) p = this.totalPages\r\n                if (p === this.page) return\r\n                this.load(p, { syncURL: true, scrollTop: true })\r\n            },\r\n\r\n            async load(pageOpt, opt) {\r\n                const options = opt || { syncURL: true, scrollTop: true }\r\n                if (pageOpt) this.page = pageOpt\r\n\r\n                if (this.page < 1) this.page = 1\r\n                if (this.loadedOnce && this.page > this.totalPages) {\r\n                    this.page = this.totalPages\r\n                }\r\n\r\n                if (options.scrollTop) this.scrollToTop()\r\n\r\n                this.loading = true\r\n                this.error = ''\r\n\r\n                try {\r\n                    const qs = new URLSearchParams({\r\n                        page: String(this.page),\r\n                        per_page: String(this.perPage),\r\n                    })\r\n\r\n                    const resp = await fetch('/api/books/?' + qs.toString(), {\r\n                        headers: { 'Accept': 'application/json' },\r\n                    })\r\n                    if (!resp.ok) {\r\n                        let msg = 'Failed to load books'\r\n                        try {\r\n                            const data = await resp.json()\r\n                            if (data && (data.error || data.message)) msg = data.error || data.message\r\n                        } catch (_) {}\r\n                        throw new Error(msg)\r\n                    }\r\n\r\n                    const payload = await resp.json()\r\n                    this.books = payload?.data ?? []\r\n                    this.total = payload?.count ?? 0\r\n                    this.loadedOnce = true\r\n\r\n                    if (this.page > this.totalPages) {\r\n                        this.page = this.totalPages\r\n                        if (options.syncURL) this.writeToURL()\r\n                        return await this.load(this.page, { syncURL: false, scrollTop: false })\r\n                    }\r\n\r\n                    if (options.syncURL) this.writeToURL()\r\n                } catch (e) {\r\n                    this.error = e?.message ?? String(e)\r\n                } finally {\r\n                    this.loading = false\r\n                }\r\n            },\r\n        }\r\n    }\r\n</script><div x-data=\"booksPage()\" class=\"p-4\"><div class=\"flex items-center justify-between pb-4\"><h1 class=\"text-3xl\">Books</h1><a class=\"btn btn-info\" href=\"/add-book/\">Add book</a></div><!-- Top pagination --><div class=\"flex items-center justify-between mb-4\"><div class=\"text-sm text-gray-500\"><span x-text=\"'Total: ' + total\"></span> <span class=\"mx-2\">•</span> <span x-text=\"'Page ' + page + ' of ' + totalPages\"></span></div><div class=\"flex items-center gap-2\"><button class=\"btn btn-sm\" :class=\"page === 1 ? 'btn-active' : ''\" :disabled=\"loading\" @click=\"gotoPage(1)\">1</button><template x-if=\"showLeftDots\"><span class=\"px-1 select-none\">...</span></template><template x-for=\"p in pageButtons\" :key=\"p\"><button class=\"btn btn-sm\" :class=\"p === page ? 'btn-active' : ''\" :disabled=\"loading\" @click=\"gotoPage(p)\" x-text=\"p\"></button></template><template x-if=\"showRightDots\"><span class=\"px-1 select-none\">...</span></template><template x-if=\"totalPages > 1\"><button class=\"btn btn-sm\" :class=\"page === totalPages ? 'btn-active' : ''\" :disabled=\"loading\" @click=\"gotoPage(totalPages)\" x-text=\"totalPages\"></button></template></div></div><template x-if=\"loading\"><div>Loading…</div></template><template x-if=\"error\"><div class=\"text-red-600\" x-text=\"error\"></div></template><template x-for=\"b in books\" :key=\"b.id\"><div class=\"card card-side bg-base-100 shadow-sm mb-2\"><template x-if=\"b.cover_file_id\"><figure><img class=\"object-cover shrink-0 w-30\" :src=\"coverURL(b.cover_file_id)\" :alt=\"b.title\" width=\"300\" loading=\"lazy\"></figure></template><div class=\"card-body\"><!-- Title row + edit icon on the right --><div class=\"flex items-start justify-between gap-3\"><h2 class=\"card-title\"><a class=\"hover:underline link-info\" :href=\"'/books/' + b.public_id + '/'\" x-text=\"b.title\"></a></h2><a class=\"btn btn-ghost btn-sm btn-square\" :title=\"'Edit'\" :href=\"'/edit-book/' + b.public_id + '/'\" aria-label=\"Edit\"><!-- simple pencil icon (inline SVG) --><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 20h9\"></path> <path d=\"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z\"></path></svg></a></div><span>by&nbsp;<template x-if=\"b.author_link\"><a class=\"hover:underline\" :href=\"b.author_link\" target=\"_blank\" rel=\"noopener noreferrer\" x-text=\"b.author_name\"></a></template><template x-if=\"!b.author_link\"><span x-text=\"b.author_name\"></span></template></span><template x-if=\"b.description\"><p x-text=\"b.description\"></p></template><a class=\"hover:underline link-info\" :href=\"'/books/' + b.public_id + '/'\">More...</a></div></div></template><template x-if=\"!loading && books.length === 0 && !error\"><div>No books found</div></template><!-- Bottom pagination --><div class=\"flex items-center justify-between mt-4\"><div class=\"text-sm text-gray-500\"><span x-text=\"'Total: ' + total\"></span> <span class=\"mx-2\">•</span> <span x-text=\"'Page ' + page + ' of ' + totalPages\"></span></div><div class=\"flex items-center gap-2\"><button class=\"btn btn-sm\" :class=\"page === 1 ? 'btn-active' : ''\" :disabled=\"loading\" @click=\"gotoPage(1)\">1</button><template x-if=\"showLeftDots\"><span class=\"px-1 select-none\">...</span></template><template x-for=\"p in pageButtons\" :key=\"p\"><button class=\"btn btn-sm\" :class=\"p === page ? 'btn-active' : ''\" :disabled=\"loading\" @click=\"gotoPage(p)\" x-text=\"p\"></button></template><template x-if=\"showRightDots\"><span class=\"px-1 select-none\">...</span></template><template x-if=\"totalPages > 1\"><button class=\"btn btn-sm\" :class=\"page === totalPages ? 'btn-active' : ''\" :disabled=\"loading\" @click=\"gotoPage(totalPages)\" x-text=\"totalPages\"></button></template></div></div></div>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
