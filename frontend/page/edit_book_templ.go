// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.960
package page

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	. "github.com/gopl-dev/server/frontend/component"
	"github.com/gopl-dev/server/frontend/component/icon"
)

// EditBookForm renders book edit page.
func EditBookForm(bookID string) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<script src=\"/assets/http_helpers.js\"></script><script src=\"/assets/file_upload_helpers.js\"></script><script src=\"/assets/form_helpers.js\"></script><script src=\"/assets/topic_picker.js\"></script><script>\r\n    const BOOK_FORM_DEFAULTS = {\r\n        title: '',\r\n        description: '',\r\n        authors: [{ name: '', link: '' }],\r\n        homepage: '',\r\n        release_date: '',\r\n        cover_file_id: '',\r\n        topics: [],\r\n    }\r\n\r\n    const BOOK_ID = \"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Var2, templ_7745c5c3_Err := templruntime.ScriptContentInsideStringLiteral(bookID)
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `frontend/page/edit_book.templ`, Line: 26, Col: 30}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ_7745c5c3_Var2)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "\"\r\n\r\n    function editBookForm() {\r\n        return {\r\n            ...FormHelpers.makeForm({\r\n                defaults: BOOK_FORM_DEFAULTS,\r\n                submit: async function () {\r\n                    const { resp, data } = await HTTP.putJSON(`/api/books/${BOOK_ID}/`, this.form)\r\n\r\n                    if (resp.status === 200) {\r\n                        this.saveRevision = data?.revision ?? 0\r\n                        this.success = true\r\n                        return\r\n                    }\r\n\r\n                    if (data?.error) this.error = data.error\r\n                    FormHelpers.applyInputErrors(this.errors, data?.input_errors)\r\n                },\r\n            }),\r\n\r\n            topics: [],\r\n            ...TopicPicker.make(),\r\n\r\n            revision: null,\r\n            revision_date: null,\r\n            saveRevision: null,\r\n\r\n            // page state\r\n            loading: true,\r\n            loadError: '',\r\n            book: null,\r\n            updatedBook: null,\r\n\r\n            // uploader (init() to bind callbacks to Alpine proxy)\r\n            upload: null,\r\n\r\n            get bookURL() {\r\n                return  `/books/${BOOK_ID}/`\r\n            },\r\n\r\n            get revisionDateFormatted() {\r\n                if (!this.revision_date) return ''\r\n\r\n                return new Date(this.revision_date).toLocaleString('en-US', {\r\n                    hour: '2-digit',\r\n                    minute: '2-digit',\r\n                    month: 'short',\r\n                    hour12: false,\r\n                    day: '2-digit'\r\n                })\r\n\r\n            },\r\n\r\n            async init() {\r\n                // init uploader\r\n                this.upload = FileUpload.makeFileUpload({\r\n                    purpose: 'book-cover',\r\n                    onUploaded: (id) => { this.form.cover_file_id = id },\r\n                    onRemoved: () => { this.form.cover_file_id = '' },\r\n                })\r\n\r\n                this.loading = true\r\n                this.loadError = ''\r\n\r\n                try {\r\n                    const { resp, data } = await HTTP.requestJSON(`/api/topics/?type=book`, { method: 'GET' })\r\n                    if (resp.status !== 200) {\r\n                        this.loadError = data?.error || 'Failed to load topics'\r\n                        return\r\n                    }\r\n\r\n                    this.topics = data?.data ?? []\r\n                } catch (err) {\r\n                    console.error(err)\r\n                    this.loadError = 'Failed to load topics'\r\n                } finally {\r\n                    this.loading = false\r\n                }\r\n\r\n                this.loading = true\r\n                this.loadError = ''\r\n\r\n                try {\r\n                    const { resp, data } = await HTTP.requestJSON(`/api/books/${BOOK_ID}/edit/`, { method: 'GET' })\r\n                    if (resp.status !== 200) {\r\n                        this.loadError = data?.error || 'Failed to load book'\r\n                        return\r\n                    }\r\n\r\n                    this.book = data.data || null\r\n                    this.revision = data?.revision ?? null\r\n                    this.revision_date = data?.revision_date ?? null\r\n\r\n                    for (const k of Object.keys(BOOK_FORM_DEFAULTS)) {\r\n                        if (k in (data.data || {})) this.form[k] = data.data[k] ?? BOOK_FORM_DEFAULTS[k]\r\n                    }\r\n\r\n                    const bookTopics = (data.data?.topics ?? [])\r\n                    this.form.topics = bookTopics.map(t => t.id).filter(Boolean)\r\n                } catch (err) {\r\n                    console.error(err)\r\n                    this.loadError = 'Failed to load book'\r\n                } finally {\r\n                    this.loading = false\r\n                }\r\n            },\r\n\r\n            addAuthorRow() {\r\n                this.form.authors.push({ name: '', link: '' })\r\n            },\r\n\r\n            removeAuthorRow(i) {\r\n                if (this.form.authors.length <= 1) return\r\n                this.form.authors.splice(i, 1)\r\n            },\r\n\r\n\r\n            dragIndex: null,\r\n            dragOverIndex: null,\r\n\r\n            onAuthorDragStart(i) {\r\n                this.dragIndex = i\r\n            },\r\n\r\n            onAuthorDragOver(e, i) {\r\n                e.preventDefault()\r\n                this.dragOverIndex = i\r\n            },\r\n\r\n            onAuthorDrop(i) {\r\n                if (this.dragIndex === null || this.dragIndex === i) {\r\n                    this.dragOverIndex = null\r\n                    return\r\n                }\r\n\r\n                const moved = this.form.authors.splice(this.dragIndex, 1)[0]\r\n                this.form.authors.splice(i, 0, moved)\r\n\r\n                this.dragIndex = null\r\n                this.dragOverIndex = null\r\n            },\r\n\r\n            onAuthorDragLeave(i) {\r\n                if (this.dragOverIndex === i) this.dragOverIndex = null\r\n            },\r\n\r\n            onAuthorDragEnd() {\r\n                this.dragIndex = null\r\n                this.dragOverIndex = null\r\n            },\r\n        }\r\n    }\r\n</script><div class=\"min-w-2xl\"><h1 class=\"text-3xl pb-4\">Edit Book</h1><div class=\"bg-base-100 w-full shadow-md\"><div class=\"card-body\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Var3 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "<div x-init=\"init()\"></div><!-- Loading --> <div x-show=\"loading\"><span class=\"loading loading-spinner\"></span> <span class=\"ml-2\">Loading book...</span></div><!-- Load error --> <p class=\"text-red-500\" x-text=\"loadError\" x-show=\"!loading && loadError !== ''\"></p><!-- Success: applied immediately --> <div role=\"alert\" class=\"alert alert-success\" x-show=\"success && (saveRevision === 0)\" x-cloak><svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6 shrink-0 stroke-current\" fill=\"none\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg><div>Book updated successfully!</div><div x-show=\"bookURL !== ''\"><a class=\"link\" :href=\"bookURL\">View book page</a></div></div><!-- Success: sent for review --> <div role=\"alert\" class=\"alert alert-info\" x-show=\"success && (saveRevision !== null) && (saveRevision > 0)\" x-cloak><svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6 shrink-0 stroke-current\" fill=\"none\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg><div><div>Thank you for your contribution! Your changes will be reviewed shortly.</div><div class=\"opacity-70\">Revision <span x-text=\"saveRevision\"></span> · <span x-text=\"new Date().toLocaleString('en-US', {hour:'2-digit', minute:'2-digit', hour12:false, month:'short', day:'2-digit'})\"></span></div><div x-show=\"bookURL !== ''\"><a class=\"link\" :href=\"bookURL\">View book page</a></div></div></div><!-- Form (only when loaded and no load error and not success) --> <div x-show=\"!loading && loadError === '' && !success\"><div role=\"alert\" class=\"alert alert-warning\" x-show=\"revision !== null && revision_date !== null\" x-cloak><div><h3 class=\"font-bold flex items-center gap-2\"><svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-6 w-6 shrink-0 stroke-current\" fill=\"none\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"></path></svg> <span>Note:</span></h3><div>You’re working on changes you previously proposed that are still under review.<br>Feel free to continue editing here, or wait until the review is complete before making new changes. Any updates you make now will be reviewed together.</div><div class=\"font-bold  font-italic\">Revision: <span x-text=\"revision\"></span> at <span x-text=\"revisionDateFormatted\"></span> by you</div><!-- TODO: add Revert and View Changes links and implement their functionality --></div></div><p class=\"text-red-500\" x-text=\"error\" x-show=\"error !== ''\"></p><fieldset class=\"fieldset\" :disabled=\"submitting\"><div x-show=\"upload !== null\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = FileUploadInput(FileUploadInputParams{
				Label: "Cover file",
				// Purpose is configured in init() uploader; keep/remove in params depending on your struct.
				FileIDModel: "form.cover_file_id",
				Accept:      "image/*",
				Preview:     true,
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, "</div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = TopicPicker().Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = Input(InputParams{
				ID:         "title",
				Label:      "Title",
				Model:      "form.title",
				ErrorModel: "errors.title",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = Textarea(InputParams{
				ID:         "description",
				Label:      "Description",
				Model:      "form.description",
				ErrorModel: "errors.description",
				Type:       "textarea",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = Input(InputParams{
				ID:          "homepage",
				Label:       "Homepage",
				Model:       "form.homepage",
				ErrorModel:  "errors.homepage",
				Description: "Where to find more information about this book",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = Input(InputParams{
				ID:         "release_date",
				Label:      "Release Date",
				Model:      "form.release_date",
				ErrorModel: "errors.release_date",
			}).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 5, "<div class=\"p-2\"><label class=\"label\"><span class=\"label-text text-lg\">Authors:</span></label><div class=\"flex flex-col gap-2\"><template x-for=\"(a, i) in form.authors\" :key=\"i\"><div class=\"relative\"><div class=\"absolute -top-1 left-0 right-0 h-1 border-t-2 border-dashed border-info\" x-show=\"dragOverIndex === i && dragIndex !== null && dragIndex !== i\" x-cloak></div><div class=\"flex gap-2 items-start p-2 rounded\" :class=\"[\r\n                dragIndex === i ? 'opacity-50' : '',\r\n                dragOverIndex === i && dragIndex !== null && dragIndex !== i ? 'bg-base-200' : ''\r\n            ].join(' ')\" draggable=\"true\" x-on:dragstart=\"onAuthorDragStart(i)\" x-on:dragover=\"onAuthorDragOver($event, i)\" x-on:dragleave=\"onAuthorDragLeave(i)\" x-on:drop=\"onAuthorDrop(i)\" x-on:dragend=\"onAuthorDragEnd()\"><div class=\"flex gap-2 flex-1\"><input type=\"text\" class=\"input input-bordered w-full\" placeholder=\"Author name\" x-model=\"a.name\"> <input type=\"url\" class=\"input input-bordered w-full\" placeholder=\"Author link (optional)\" x-model=\"a.link\"></div><div><button type=\"button\" class=\"btn btn-ghost btn-success px-2\" x-on:click=\"addAuthorRow()\" aria-label=\"Add author\" title=\"Add author\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = icon.SquarePlus().Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 6, "</button> <button type=\"button\" class=\"btn btn-ghost btn-error px-2\" x-on:click=\"removeAuthorRow(i)\" :disabled=\"form.authors.length <= 1\" :class=\"form.authors.length <= 1 ? 'btn-disabled' : ''\" aria-label=\"Remove author\" title=\"Remove author\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = icon.SquareMinus().Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 7, "</button><div class=\"btn  btn-ghost cursor-move select-none\" title=\"Drag to reorder\">≡</div></div></div></div></template><p class=\"text-error text-sm\" x-show=\"errors.authors\" x-text=\"errors.authors\"></p></div></div><div class=\"p-2\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = SubmitButton("Save changes").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 8, "</div></fieldset></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = Form("editBookForm").Render(templ.WithChildren(ctx, templ_7745c5c3_Var3), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 9, "</div></div></div>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
