// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.960
package page

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

// import "github.com/gopl-dev/server/frontend/component/icon"
func FilterEventLogsPage() templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<script src=\"/assets/http_helpers.js\"></script><script src=\"/assets/helpers.js\"></script><script>\r\n    function eventLogsPage() {\r\n        return {\r\n            logs: [],\r\n            loading: false,\r\n            error: '',\r\n            total: 0,\r\n            loadedOnce: false,\r\n\r\n            filters: {\r\n                page: 1,\r\n                per_page: 100,\r\n            },\r\n\r\n            get totalPages() {\r\n                return Math.max(1, Math.ceil(this.total / this.filters.per_page))\r\n            },\r\n\r\n            readFromURL() {\r\n                const url = new URL(window.location.href)\r\n\r\n                const p = parseInt(url.searchParams.get('page') || '', 10)\r\n                if (Number.isFinite(p) && p > 0) this.filters.page = p\r\n                else this.filters.page = 1\r\n            },\r\n\r\n            writeToURL() {\r\n                const url = new URL(window.location.href)\r\n\r\n                if (this.filters.page === 1) url.searchParams.delete('page')\r\n                else url.searchParams.set('page', String(this.filters.page))\r\n\r\n                window.history.replaceState({}, '', url.toString())\r\n            },\r\n\r\n            onPopState() {\r\n                this.readFromURL()\r\n                this.load({ syncURL: false, scrollTop: true })\r\n            },\r\n\r\n            // ---------- pagination ui ----------\r\n\r\n            scrollToTop() {\r\n                if (window.scrollY > 80) {\r\n                    window.scrollTo({ top: 0, behavior: 'smooth' })\r\n                }\r\n            },\r\n\r\n            get pageButtons() {\r\n                const max = this.totalPages\r\n                const cur = this.filters.page\r\n\r\n                const start = Math.max(2, cur - 3)\r\n                const end = Math.min(max - 1, cur + 3)\r\n\r\n                const btns = []\r\n                for (let p = start; p <= end; p++) btns.push(p)\r\n                return btns\r\n            },\r\n\r\n            get showLeftDots() {\r\n                return this.pageButtons.length > 0 && this.pageButtons[0] > 2\r\n            },\r\n\r\n            get showRightDots() {\r\n                const btns = this.pageButtons\r\n                return btns.length > 0 && btns[btns.length - 1] < this.totalPages - 1\r\n            },\r\n\r\n            gotoPage(p) {\r\n                if (p < 1) p = 1\r\n                if (p > this.totalPages) p = this.totalPages\r\n                if (p === this.filters.page) return\r\n\r\n                this.filters.page = p\r\n                this.load({ syncURL: true, scrollTop: true })\r\n            },\r\n\r\n            buildLogsQS() {\r\n                const qs = new URLSearchParams({\r\n                    page: String(this.filters.page),\r\n                    per_page: String(this.filters.per_page),\r\n                })\r\n\r\n                for (const id of (this.filters.topic_ids ?? [])) {\r\n                    qs.append('topics', id)\r\n                }\r\n\r\n                return qs.toString()\r\n            },\r\n\r\n            async load(opt) {\r\n                const options = opt || { syncURL: true, scrollTop: true }\r\n                if (this.filters.page < 1) this.filters.page = 1\r\n                if (this.loadedOnce && this.filters.page > this.totalPages) {\r\n                    this.filters.page = this.totalPages\r\n                }\r\n\r\n                if (options.scrollTop) this.scrollToTop()\r\n\r\n                this.loading = true\r\n                this.error = ''\r\n\r\n                try {\r\n                    const { resp, data } = await HTTP.requestJSON('/api/event-logs/?' + this.buildLogsQS())\r\n                    if (resp.status !== 200) {\r\n                        this.error = data?.error || 'Failed to load log'\r\n                        return\r\n                    }\r\n\r\n                    this.logs = data?.data ?? []\r\n                    this.total = data?.count ?? 0\r\n                    this.loadedOnce = true\r\n\r\n                    if (this.filters.page > this.totalPages) {\r\n                        this.filters.page = this.totalPages\r\n                        if (options.syncURL) this.writeToURL()\r\n                        return await this.load({ syncURL: false, scrollTop: false })\r\n                    }\r\n\r\n                    if (options.syncURL) this.writeToURL()\r\n                } catch (e) {\r\n                    this.error = e?.message ?? String(e)\r\n                } finally {\r\n                    this.loading = false\r\n                }\r\n            },\r\n\r\n            init() {\r\n                this.readFromURL()\r\n                window.addEventListener('popstate', () => this.onPopState())\r\n                this.load({ syncURL: false, scrollTop: false })\r\n            },\r\n        }\r\n    }\r\n</script><div x-data=\"eventLogsPage()\"><h1 class=\"text-3xl mb-3\">Look what we did here:</h1><template x-if=\"loading\"><div>Loading…</div></template><template x-if=\"error\"><div class=\"text-red-600\" x-text=\"error\"></div></template><ul class=\"list text-lg\"><template x-for=\"l in logs\" :key=\"l.id\"><li class=\"list-row hover:bg-base-100\"><div x-html=\"l.message\"></div><div x-text=\"l.date\" class=\"text-gray-500 text-right\"></div></li></template></ul><template x-if=\"!loading && logs.length === 0 && !error\"><div>Nothing here</div></template><!-- Bottom pagination --><div class=\"flex items-center justify-between mt-4\"><div class=\"text-sm text-gray-500\"><span x-text=\"'Total: ' + total\"></span> <span class=\"mx-2\">•</span> <span x-text=\"'Page ' + filters.page + ' of ' + totalPages\"></span></div><div class=\"flex items-center gap-2\"><button class=\"btn btn-sm\" :class=\"filters.page === 1 ? 'btn-active' : ''\" :disabled=\"loading\" @click=\"gotoPage(1)\">1</button><template x-if=\"showLeftDots\"><span class=\"px-1 select-none\">...</span></template><template x-for=\"p in pageButtons\" :key=\"p\"><button class=\"btn btn-sm\" :class=\"p === filters.page ? 'btn-active' : ''\" :disabled=\"loading\" @click=\"gotoPage(p)\" x-text=\"p\"></button></template><template x-if=\"showRightDots\"><span class=\"px-1 select-none\">...</span></template><template x-if=\"totalPages > 1\"><button class=\"btn btn-sm\" :class=\"filters.page === totalPages ? 'btn-active' : ''\" :disabled=\"loading\" @click=\"gotoPage(totalPages)\" x-text=\"totalPages\"></button></template></div></div></div>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
